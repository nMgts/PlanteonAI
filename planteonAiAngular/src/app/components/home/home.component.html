<div class="home-container">

  <!-- Sidebar -->
  <div class="sidebar" *ngIf="isLeftSidebarOpen">

    <div class="sidebar-icons">
      <button class="icon-button" title="Menu"
              (click)="isLeftSidebarOpen = false" title="Zamknij">
        <i class="material-icons">menu</i>
      </button>
      <button class="icon-button" title="Nowy czat" (click)="createNewChat()">
        <i class="material-icons">add</i>
      </button>
    </div>

    <div class="chat-list">
      <div class="chat-item" *ngFor="let chat of chatList">
        {{ chat.title }}
        <button class="icon-button" (click)="deleteChat(chat.id); $event.stopPropagation()" title="Usuń czat" style="float: right;">
          <i class="material-icons">delete</i>
        </button>
      </div>
    </div>
  </div>

  <div class="main-content" [ngStyle]="{
        'margin-left': isLeftSidebarOpen ? '280px' : '0',
        'margin-right': isRightSidebarOpen ? '280px' : '0'
     }">

    <!-- Ikonki w lewym górnym rogu (widoczne tylko gdy sidebar zamknięty) -->
    <div class="top-icons left" *ngIf="!isLeftSidebarOpen">
      <button class="icon-button" (click)="isLeftSidebarOpen = true" title="Menu">
        <i class="material-icons">menu</i>
      </button>
      <button class="icon-button" title="Nowy czat" (click)="createNewChat()">
        <i class="material-icons">add</i>
      </button>
    </div>

    <!-- Ikonki w prawym górnym rogu (widoczne tylko gdy prawy sidebar zamknięty) -->
    <div class="top-icons right" *ngIf="!isRightSidebarOpen">
      <button class="icon-button" (click)="isRightSidebarOpen = true" title="Menu">
        <i class="material-icons">menu</i>
      </button>

      <div class="avatar-wrapper" (click)="toggleAvatarMenu()">
        <div class="avatar">JS</div>
        <div class="avatar-menu" *ngIf="isAvatarMenuOpen">
          <div class="avatar-menu-item">Ustawienia</div>
          <div class="avatar-menu-item" (click)="logout()">Wyloguj</div>
        </div>
      </div>
    </div>

    <div class="chat-box" [ngClass]="{ 'with-messages': messages.length > 0 }">

      <!-- Nagłówek tylko, gdy nie ma wiadomości -->
      <h2 class="chat-header" *ngIf="messages.length === 0">
        W czym mogę Ci pomóc?
      </h2>

      <!-- Lista wiadomości -->
      <div class="messages-container" *ngIf="messages.length > 0">
        <div
          *ngFor="let msg of messages"
          [ngClass]="msg.type === 'INPUT' ? 'message user-message' : 'message bot-message'">
          {{ msg.text }}
        </div>
      </div>

      <!-- Panel na dole lub na środku -->
      <div class="chat-panel" [ngClass]="{ 'at-bottom': messages.length > 0 }">
        <textarea
          #textareaRef
          [(ngModel)]="newMessage"
          class="chat-textarea"
          placeholder="Napisz wiadomość..."
          (ngModelChange)="onInputChange()">
        </textarea>

        <div class="chat-toolbar">
          <button class="icon-button" title="Dodaj">
            <i class="material-icons">add</i>
          </button>

          <div class="right-icons">
            <button class="icon-button" title="Nagraj wiadomość">
              <i class="material-icons">mic</i>
            </button>
            <button class="icon-button" title="Wyślij" (click)="sendMessage()">
              <i class="material-icons">send</i>
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Prawy sidebar -->
  <div class="sidebar right-sidebar" *ngIf="isRightSidebarOpen">
    <div class="sidebar-icons">
      <button class="icon-button" (click)="isRightSidebarOpen = false" title="Zamknij">
        <i class="material-icons">menu</i>
      </button>

      <div class="avatar-wrapper" (click)="toggleAvatarMenu()">
        <div class="avatar">JS</div>
        <div class="avatar-menu" *ngIf="isAvatarMenuOpen">
          <div class="avatar-menu-item">Ustawienia</div>
          <div class="avatar-menu-item" (click)="logout()">Wyloguj</div>
        </div>
      </div>
    </div>

    <div class="chat-list">
      <p>Notatki</p>
      <p>Użytkownicy</p>
      <p>opcja 1</p>
      <p>opcja 2</p>
    </div>
  </div>
</div>
